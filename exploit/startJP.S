// Copyright 2016 FIX94
// This code is licensed to you under the terms of the GNU GPL, version 2;
// see file LICENSE or http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt

#define XSTR(x) #x
#define ISTR(x) XSTR(x)

	.section .start,"ax"

	.incbin "head.b"

0:	.ascii ISTR(WW Hack)
	// new lines to get junk from screen
	.fill 0x10,1,0xA
	// some filling
	.fill 0xD,1,0x20
	// reflects this position
	.long (baddr+0x184)
	// some more filling (0x80 prevents NTSC crash somehow)
	.fill 0xD,1,0x80
	// actual jump
	.long start
	// and more filling
	.fill 3,1,0x20
	// and the initial broken register
	.long (baddr-0x100)

	// Align things properly -- there's code after this.
	.balign 4,0

start:
	# Disable interrupts
	mfmsr 3 ; rlwinm 3,3,0,17,15 ; mtmsr 3 ; isync

	// Go for it!
	b _main

	.section .jloc1
	.long (baddr+0x184)

	.section .someaddr1
	.long 0x80800000

	.section .someaddr2
	.long 0x80800000

	.section .important
	.byte 0x10

	.section .nocrash
	.byte 0x01
