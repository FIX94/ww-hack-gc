// Copyright 2008-2009  Segher Boessenkool  <segher@kernel.crashing.org>
// GameCube Port Copyright 2016 FIX94
// This code is licensed to you under the terms of the GNU GPL, version 2;
// see file LICENSE or http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt

void ar_dma(unsigned int type, unsigned int mram, unsigned int aram, unsigned int len)
{
	*(volatile unsigned short*)0xCC005020 = (mram>>16);
	*(volatile unsigned short*)0xCC005022 = (mram&0xFFFF);
	*(volatile unsigned short*)0xCC005024 = (aram>>16);
	*(volatile unsigned short*)0xCC005026 = (aram&0xFFFF);
	*(volatile unsigned short*)0xCC005028 = (type<<15)|(len>>16);
	*(volatile unsigned short*)0xCC00502A = (len&0xFFFF);
	while(*(volatile unsigned short*)0xCC00500A & 0x200) ;
}

void sync_cache(void *p, unsigned int n)
{
	unsigned int start, end;

	start = (unsigned int)p & ~31;
	end = ((unsigned int)p + n + 31) & ~31;
	n = (end - start) >> 5;

	while (n--) {
		asm("dcbst 0,%0 ; icbi 0,%0" : : "b"(p));
		p += 32;
	}
	asm("sync ; isync");
}

void *_memcpy(void *ptr, const void *src, int size)
{
	char* ptr2 = ptr;
	const char* src2 = src;
	while(size--) *ptr2++ = *src2++;
	return ptr;
}
