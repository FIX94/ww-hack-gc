// Copyright 2016 FIX94
// This code is licensed to you under the terms of the GNU GPL, version 2;
// see file LICENSE or http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt

#define XSTR(x) #x
#define ISTR(x) XSTR(x)

	.section .start,"ax"

	.incbin "head.b"

0:	.byte 0xFF
	//reflects this position (will load this+0x10 for jump)
	.long (baddr+0x160)
	// some filling
	.fill 0xC,1,0xFF
	// actual jump
	.long start
	// more filling
	.fill 0xF,1,0xFF
	// corrupted position for NTSC-J
	.long (baddr+0x160)
	// fill to reach NTSC-U crashpoint
	.fill 0x2C,1,0xFF
	// corrupted position for NTSC-U
	.long (baddr+0x160)
	// fill to reach PAL crashpoint
	.fill 0x194,1,0xFF
	// corrupted position for PAL
	.long (baddr+0x160)
	// Align things properly -- there's code after this.
	.balign 4,0

start:
	// Disable interrupts
	mfmsr 3 ; rlwinm 3,3,0,17,15 ; mtmsr 3 ; isync

	// Set up a stack frame.
	lis 1,0x8000 ; ori 1,1,0x3000 ; li 0,0 ; stwu 0,-64(1)

	// Go for it!
	b _main
